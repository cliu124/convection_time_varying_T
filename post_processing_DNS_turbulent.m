clear all;
close all;

% folder_path='E:\Data\dedalus_turbulent_channel';
folder_path='E:\Data\dedalus';

%slurm_list={'10249087'};
slurm_list={'10439614'};
%slurm_list={'10611110'};

stress_list={'u_prime_u_prime',...
    'v_prime_v_prime',...
    'w_prime_w_prime',...
    'u_prime_v_prime',...
    'T_prime_T_prime',...
    'u_prime_T_prime',...
    'v_prime_T_prime',...
    'w_prime_T_prime',...
    'T_bar',...
    'u_bar'};
stress_label_list={'$\langle u''u''\rangle $',...
    '$\langle v''v''\rangle$',...
    '$\langle w''w''\rangle$',...
    '$\langle u''v''\rangle$',...
    '$\langle T''T''\rangle$',...
    '$\langle u''T''\rangle$',...
    '$\langle v''T''\rangle$',...
    '$\langle w''T''\rangle$',...
    '$\bar{T}$',...
    '$\bar{u}$'};

Re_tau=180;

% Re_tau=395;

% average_range=[800,931];
% average_range=[1,4000];
average_range=[1,500];
for slurm_ind=1:length(slurm_list)
    % data{slurm_ind}.y=squeeze(h5read([folder_path,'\dedalus_',slurm_list{slurm_ind},'\snapshots_channel_stress\snapshots_channel_stress_s1.h5'],['/scales/']));
    h5name=[folder_path,'\dedalus_',slurm_list{slurm_ind},'\snapshots_channel_stress\snapshots_channel_stress_s1.h5'];
    for stress_ind=1:length(stress_list)
        clear data_plot data_plot_log; 
        data{slurm_ind}.(stress_list{stress_ind})=squeeze(h5read(h5name,['/tasks/',stress_list{stress_ind}]));
        data{slurm_ind}.y=readDatasetByPrefix(h5name,'/scales', 'y_hash_');
        
        %h5read(h5name,'/scales/y_hash_04efb45f3573dba433867d7f01cfa48347d433e5');

        data_plot{1}.x=data{slurm_ind}.y;
        data_plot{1}.y=mean(data{slurm_ind}.(stress_list{stress_ind})(:,average_range),2); 
        %if ~strcmp(stress_list{stress_ind},'T_bar')
        %     data_plot = add_DNS_stress_literature(data_plot,stress_list{stress_ind},Re_tau);
        % end
        data_plot = add_DNS_stress_literature(data_plot,stress_list{stress_ind},Re_tau);

        plot_config.label_list={1,'y',stress_label_list{stress_ind}}; 
        plot_config.Markerindex=3;
        plot_config.user_color_style_marker_list={'k-','bo','rx','g*'};
        plot_config.name=[folder_path,'\dedalus_',slurm_list{slurm_ind},'\snapshots_channel_stress\',stress_list{stress_ind},'.png'];
        plot_config.xlim_list = [1,-1,1];
        plot_config.loglog = [0,0];
        plot_line(data_plot,plot_config);
        data_plot_log = data_plot;

        for data_ind=1:length(data_plot_log)
            data_plot_log{data_ind}.x = Re_tau*(1+data_plot_log{data_ind}.x);
        end
%       data_plot_log = add_DNS_stress_literature(data_plot,stress_list{stress_ind},Re_tau);

        % if ~strcmp(stress_list{stress_ind},'T_bar')
        %     data_plot_log = add_DNS_stress_literature(data_plot_log,stress_list{stress_ind},Re_tau);
        % end
        plot_config.xlim_list = [1,1,Re_tau];
        plot_config.loglog = [1,0];
        plot_config.name=[folder_path,'\dedalus_',slurm_list{slurm_ind},'\snapshots_channel_stress\',stress_list{stress_ind},'_log.png'];
        plot_line(data_plot_log,plot_config);
        
    end
    
end

function data = readDatasetByPrefix(filename, groupPath, prefix)
% readDatasetByPrefix  Read dataset from an HDF5 group by matching prefix
%
%   data = readDatasetByPrefix(filename, groupPath, prefix)
%
%   Example:
%       y = readDatasetByPrefix('output/data_s1.h5', '/scales', 'y_hash_');
%

    info = h5info(filename, groupPath);
    data = [];

    for i = 1:length(info.Datasets)
        dset = info.Datasets(i);
        if startsWith(dset.Name, prefix)
            dset_path = [groupPath '/' dset.Name];
            data = h5read(filename, dset_path);
            fprintf('Found dataset: %s\n', dset_path);
            return;
        end
    end

    error('No dataset starting with "%s" found in %s.', prefix, groupPath);
end

function data=add_DNS_stress_literature(data,stress_name,Re_tau)
    switch Re_tau
        case 180
            switch stress_name
                case 'u_prime_u_prime'
                    %Kim J, Moin P, Moser R. Turbulence statistics in fully developed channel flow at low Reynolds number. Journal of fluid mechanics. 1987 Apr;177:133-66.
                    %Re_tau=180
                    stress=[-0.9859	0.889723
                    -0.985672	1.00096
                    -0.982318	1.13996
                    -0.982047	1.27206
                    -0.978807	1.35544
                    -0.978601	1.45625
                    -0.972177	1.59521
                    -0.971942	1.70992
                    -0.968659	1.81416
                    -0.966932	1.908
                    -0.960145	2.22424
                    -0.956726	2.39453
                    -0.945776	2.49519
                    -0.940951	2.60289
                    -0.933134	2.6723
                    -0.920827	2.68604
                    -0.905528	2.66149
                    -0.887273	2.58128
                    -0.873608	2.50809
                    -0.859958	2.42795
                    -0.849356	2.35828
                    -0.837227	2.28511
                    -0.822056	2.19799
                    -0.808384	2.12827
                    -0.797761	2.06903
                    -0.784068	2.00974
                    -0.762765	1.91907
                    -0.741447	1.83534
                    -0.723178	1.76208
                    -0.686547	1.66076
                    -0.669756	1.61534
                    -0.636117	1.5523
                    -0.614721	1.50681
                    -0.582596	1.45422
                    -0.553511	1.41558
                    -0.522906	1.36996
                    -0.476981	1.31022
                    -0.440236	1.26452
                    -0.405027	1.21884
                    -0.371352	1.17318
                    -0.334622	1.12053
                    -0.299412	1.07485
                    -0.261154	1.0187
                    -0.221347	0.969474
                    -0.195325	0.93435
                    -0.166226	0.902659
                    -0.1356	0.867471
                    -0.100369	0.832218
                    -0.0620469	0.807352
                    -0.0190988	0.79285
                    0.00238946	0.792551
                    0.0576663	0.802211
                    0.105297	0.825882
                    0.152957	0.863458
                    0.183718	0.894317
                    0.211403	0.921742
                    0.237553	0.949188
                    0.265252	0.983565
                    0.29602	1.0179
                    0.336027	1.06601
                    0.388333	1.12438
                    0.426798	1.16904
                    0.472965	1.22749
                    0.522216	1.29285
                    0.577642	1.37551
                    0.611531	1.43414
                    0.639279	1.49285
                    0.670119	1.56195
                    0.696354	1.63111
                    0.719513	1.69683
                    0.758105	1.80406
                    0.778243	1.89416
                    0.796833	1.97733
                    0.812345	2.05707
                    0.830977	2.1611
                    0.843405	2.23393
                    0.860524	2.34841
                    0.88074	2.47675
                    0.900907	2.58075
                    0.922481	2.62217
                    0.943756	2.51758
                    0.951174	2.39234
                    0.957022	2.24973
                    0.962734	2.04107
                    0.968312	1.76637
                    0.975538	1.54727
                    0.981172	1.30038
                    0.986657	0.980487
                    0.990835	0.771854
                    0.996591	0.584057
                    ];
                    stress(:,2)=stress(:,2).^2;
                
                    data_len=length(data);
                    data{data_len+1}.x=stress(:,1);
                    data{data_len+1}.y=stress(:,2);
                case 'v_prime_v_prime'
                      %Kim J, Moin P, Moser R. Turbulence statistics in fully developed channel flow at low Reynolds number. Journal of fluid mechanics. 1987 Apr;177:133-66.
                    %Re_tau=180
                    stress=[-0.979904	0.0692455
                        -0.965934	0.145529
                        -0.950393	0.239171
                        -0.93795	0.318952
                        -0.922438	0.39869
                        -0.903842	0.485337
                        -0.882176	0.571942
                        -0.86208	0.641188
                        -0.83738	0.710369
                        -0.806575	0.762084
                        -0.774258	0.80335
                        -0.737378	0.823695
                        -0.697457	0.830092
                        -0.66062	0.82958
                        -0.614588	0.821987
                        -0.571654	0.800533
                        -0.534838	0.789592
                        -0.499579	0.768244
                        -0.453568	0.750223
                        -0.421371	0.732395
                        -0.376896	0.714395
                        -0.338559	0.696481
                        -0.300209	0.685519
                        -0.258803	0.667562
                        -0.217397	0.649605
                        -0.180574	0.64214
                        -0.140688	0.631157
                        -0.103873	0.620216
                        -0.0639659	0.619661
                        -0.0225243	0.619085
                        0.0219871	0.618466
                        0.0572964	0.621451
                        0.0956683	0.620918
                        0.135589	0.627315
                        0.177052	0.637167
                        0.218522	0.650496
                        0.256923	0.663867
                        0.299928	0.677174
                        0.336786	0.68709
                        0.372124	0.70398
                        0.41208	0.727758
                        0.453572	0.751515
                        0.488902	0.764928
                        0.528859	0.788706
                        0.571871	0.80549
                        0.607202	0.818903
                        0.647151	0.839205
                        0.684002	0.845645
                        0.725437	0.841593
                        0.765315	0.827134
                        0.800532	0.784929
                        0.832658	0.732338
                        0.861692	0.669362
                        0.883024	0.592588
                        0.902835	0.522788
                        0.922603	0.432131
                        0.937767	0.341537
                        0.949883	0.261415
                        0.961984	0.174341
                        0.97869	0.0872025
                        0.989313	0.0279586
                        ];
                        stress(:,2)=stress(:,2).^2;
                    data_len=length(data);
                    data{data_len+1}.x=stress(:,1);
                    data{data_len+1}.y=stress(:,2);
                case 'w_prime_w_prime'
                      %Kim J, Moin P, Moser R. Turbulence statistics in fully developed channel flow at low Reynolds number. Journal of fluid mechanics. 1987 Apr;177:133-66.
                    %Re_tau=180
                    stress=[-0.983826	0.40302
                        -0.975917	0.517626
                        -0.968022	0.62528
                        -0.947741	0.784905
                        -0.933757	0.86814
                        -0.909021	0.954702
                        -0.882821	1.00648
                        -0.841287	1.0511
                        -0.801359	1.06097
                        -0.758361	1.0708
                        -0.687828	1.03506
                        -0.652569	1.01371
                        -0.614246	0.988842
                        -0.575924	0.963976
                        -0.529949	0.928574
                        -0.497767	0.903793
                        -0.451806	0.861439
                        -0.410421	0.833053
                        -0.379773	0.808293
                        -0.344514	0.786946
                        -0.309261	0.762122
                        -0.269404	0.737234
                        -0.241827	0.712517
                        -0.197372	0.684089
                        -0.145236	0.65903
                        -0.116109	0.641244
                        -0.0624239	0.623116
                        -0.016399	0.612047
                        0.0235078	0.611492
                        0.0680405	0.621302
                        0.106434	0.631197
                        0.157127	0.651349
                        0.197077	0.671651
                        0.249319	0.698735
                        0.278525	0.719186
                        0.324642	0.753307
                        0.36462	    0.787514
                        0.401528	0.821763
                        0.441506	0.85597
                        0.473788	0.879855
                        0.510697	0.914104
                        0.546063	0.944898
                        0.579887	0.972238
                        0.621393	1.00295
                        0.653675	1.02683
                        0.702862	1.06091
                        0.741277	1.08123
                        0.790421	1.09446
                        0.816514	1.09409
                        0.847169	1.07281
                        0.882378	1.02713
                        0.908372	0.978099
                        0.92512	    0.911818
                        0.949429	0.789811
                        0.958503	0.723636
                        0.970562	0.615705
                        0.978072	0.535647
                        0.984041	0.452134
                        0.990024	0.375573
                        0.994465	0.295558
                        ];
                    stress(:,2)=stress(:,2).^2;
                    data_len=length(data);
                    data{data_len+1}.x=stress(:,1);
                    data{data_len+1}.y=stress(:,2);
                case 'u_prime_v_prime'
                %stress=[
                %        ];
                %    stress(:,2)=stress(:,2).^2;
                %    data_len=length(data);
                %    data{data_len+1}.x=stress(:,1);
                %    data{data_len+1}.y=stress(:,2);
                case 'T_prime_T_prime'
                % Kasagi N, Tomita Y, Kuroda A. Direct numerical simulation of passive scalar field in a turbulent channel flow.                    T_bar=[0.999768	0.670613
                % Re_tau=150
                stress=[1.00998	0.263899
                        1.06631	0.291731
                        1.17586	0.310348
                        1.25506	0.328932
                        1.36892	0.370686
                        1.46111	0.38927
                        1.61107	0.435665
                        1.73831	0.463519
                        1.88577	0.500638
                        2.04566	0.547016
                        2.1834	0.570229
                        2.28027	0.593421
                        2.44679	0.649048
                        2.61131	0.695409
                        2.81746	0.732523
                        3.08941	0.811319
                        3.29703	0.86694
                        3.44314	0.904021
                        3.83744	0.992093
                        4.11752	1.05698
                        4.27661	1.09868
                        4.61361	1.17283
                        5.00438	1.24236
                        5.36909	1.33502
                        5.88704	1.42771
                        6.35051	1.52038
                        6.70389	1.58062
                        7.07681	1.64549
                        7.47022	1.71961
                        8.01518	1.79376
                        8.59932	1.88642
                        9.12716	1.9513
                        10.3391	2.05327
                        10.9147	2.10888
                        11.7115	2.16914
                        12.6343	2.24329
                        15.0305	2.33143
                        16.5737	2.36856
                        18.7792	2.4011
                        20.5991	2.38267
                        23.3458	2.35039
                        26.8952	2.30424
                        28.8693	2.26264
                        32.367	2.21183
                        34.3688	2.15633
                        38.3245	2.10089
                        41.1404	2.04077
                        44.8923	1.96216
                        50.0661	1.86967
                        53.7437	1.81419
                        57.6905	1.76334
                        61.2614	1.69395
                        66.8428	1.63848
                        72.1476	1.56912
                        76.1955	1.50899
                        83.1445	1.43037
                        91.2234	1.34713
                        99.5513	1.24537
                        106.866	1.18525
                        113.479	1.1205
                        120.501	1.05574
                        131.49	0.977127
                        140.372	0.944785
                        153.988	0.903212];
                    stress(:,1)=stress(:,1)/150-1;
                    stress(:,2)=stress(:,2).^2;
                    data_len=length(data);
                    data{data_len+1}.x=stress(:,1);
                    data{data_len+1}.y=stress(:,2);
                case 'u_prime_T_prime'
                % Kasagi N, Tomita Y, Kuroda A. Direct numerical simulation of passive scalar field in a turbulent channel flow.                    T_bar=[0.999768	0.670613
                % Re_tau=150
                stress=[-0.998478727	0.025536
                        -0.996374233	0.0893022
                        -0.9932164	    0.16583
                        -0.991114133	0.26784
                        -0.9890104	    0.344354
                        -0.986909667	0.471859
                        -0.985863	    0.599351
                        -0.982708133	0.72687
                        -0.980605867	0.82888
                        -0.980611133	0.918115
                        -0.978511867	1.07112
                        -0.976410333	1.18587
                        -0.9764178	    1.31335
                        -0.974317067	1.44086
                        -0.973271133	1.5811
                        -0.971171867	1.7341
                        -0.971179333	1.86158
                        -0.9669756	    2.07835
                        -0.964884533	2.37157
                        -0.9617342	    2.57558
                        -0.960692	    2.77956
                        -0.958594267	2.95806
                        -0.956498733	3.1748
                        -0.953349067	3.39155
                        -0.952306133	3.58278
                        -0.951261733	3.74852
                        -0.947062467	4.04177
                        -0.943912867	4.25853
                        -0.939709867	4.48804
                        -0.9365632	    4.75579
                        -0.932360667	4.99805
                        -0.927103333	5.21483
                        -0.921846	    5.44436
                        -0.915534	    5.66115
                        -0.907109333	5.80149
                        -0.896571333	5.85261
                        -0.884976667	5.86551
                        -0.877592667	5.77637
                        -0.868096667	5.62352
                        -0.858601333	5.48341
                        -0.848050667	5.31782
                        -0.838552667	5.12672
                        -0.831164	    4.9611
                        -0.819558667	4.78277
                        -0.809005333	4.57894
                        -0.798451333	4.36236
                        -0.786844667	4.15855
                        -0.775238	    3.96748
                        -0.762576	    3.75092
                        -0.749916	    3.57261
                        -0.730926667	3.30515
                        -0.714047333	3.0759
                        -0.700336	    2.93585
                        -0.678184	    2.66843
                        -0.654982	    2.47751
                        -0.638106667	2.312
                        -0.611743333	2.13387
                        -0.586434667	1.95572
                        -0.565344667	1.82851
                        -0.544256667	1.72679
                        -0.527384	    1.61228
                        -0.504188667	1.52334
                        -0.478882	    1.39618
                        -0.459904	    1.31994
                        -0.4346	        1.23102
                        -0.411406	    1.16758
                        -0.386102667	1.09142
                        -0.361852667	1.00249
                        -0.337604	    0.926312
                        -0.307033333	0.850215
                        -0.27962	    0.774077
                        -0.25748	    0.71062
                        -0.22796	    0.634509
                        -0.204766667	0.609309
                        -0.182626667	0.545851
                        -0.154166667	0.520719
                        -0.128866667	0.495545
                        -0.105673333	0.457597
                        -0.0867	        0.457839
                        -0.056126667	0.419985
                        -0.035046667	0.407506
                        -0.008693333	0.395094
                        -0.00026	    0.40795
                        ];
                    % stress(:,2)=stress(:,2).^2;
                    data_len=length(data);
                    data{data_len+1}.x=stress(:,1);
                    data{data_len+1}.y=stress(:,2);
                case 'v_prime_T_prime'
                % Kasagi N, Tomita Y, Kuroda A. Direct numerical simulation of passive scalar field in a turbulent channel flow.                    T_bar=[0.999768	0.670613
                % Re_tau=150
                stress=[
                        -0.983219267	0.00638613
                        -0.979993267	0.0145682
                        -0.973538867	0.0292968
                        -0.969254733	0.0521996
                        -0.963889067	0.0734686
                        -0.958532733	0.101279
                        -0.955337333	0.130723
                        -0.949995133	0.168346
                        -0.942496733	0.207608
                        -0.9371616	0.250138
                        -0.931826667	0.292668
                        -0.925412	0.3352
                        -0.917934667	0.389181
                        -0.910441333	0.431715
                        -0.901878	0.480791
                        -0.893304667	0.523326
                        -0.882571333	0.564228
                        -0.872892667	0.588774
                        -0.867529333	0.611679
                        -0.851385333	0.642776
                        -0.834157333	0.670604
                        -0.807206	0.691905
                        -0.774837333	0.698494
                        -0.745688	0.691994
                        -0.719766667	0.678948
                        -0.69168	0.660999
                        -0.660353333	0.641418
                        -0.637665333	0.625097
                        -0.607415333	0.60388
                        -0.583631333	0.576111
                        -0.558787333	0.561428
                        -0.536092	0.5402
                        -0.513392	0.515701
                        -0.493946667	0.502645
                        -0.471249333	0.479782
                        -0.448551333	0.456918
                        -0.419376	0.432428
                        -0.396678667	0.409565
                        -0.376142	0.388334
                        -0.354524	0.365468
                        -0.330746667	0.340971
                        -0.302646667	0.31648
                        -0.283186667	0.293611
                        -0.261573333	0.274017
                        -0.2432	0.252783
                        -0.224826667	0.234819
                        -0.205366667	0.211951
                        -0.17836	0.194
                        -0.1589	0.171132
                        -0.13836	0.148265
                        -0.114573333	0.120496
                        -0.09728	0.102531
                        -0.07134	0.0747661
                        -0.04864	0.053538
                        -0.029186667	0.0323051
                        -0.016213333	0.0176047
                        -0.001086667	0.00454297
                       ];
                    % stress(:,2)=stress(:,2).^2;
                    stress(:,2)=-stress(:,2);
                    data_len=length(data);
                    data{data_len+1}.x=stress(:,1);
                    data{data_len+1}.y=stress(:,2);
                case 'w_prime_T_prime'
                %stress=[
                %        ];
                %    stress(:,2)=stress(:,2).^2;
                %    data_len=length(data);
                %    data{data_len+1}.x=stress(:,1);
                %    data{data_len+1}.y=stress(:,2);
                case 'T_bar'
                % Kasagi N, Tomita Y, Kuroda A. Direct numerical simulation of passive scalar field in a turbulent channel flow.                    
                % Re_tau=150
                T_bar=[0.999768	0.670613
                        1.03494	0.670317
                        1.10899	0.788069
                        1.22168	0.866135
                        1.32734	0.94432
                        1.43222	0.983116
                        1.63321	1.13978
                        1.87533	1.29639
                        2.09458	1.49268
                        2.2757	1.61031
                        2.47252	1.6885
                        2.70481	1.96386
                        2.97963	2.08138
                        3.25965	2.27785
                        3.59074	2.47426
                        3.84745	2.7498
                        4.26764	2.94615
                        4.6046	3.14274
                        4.93379	3.41828
                        5.28651	3.69382
                        5.9044	3.96901
                        6.3266	4.20511
                        6.59397	4.48088
                        7.26323	4.87453
                        7.94529	5.26824
                        8.87322	5.78012
                        9.97827	6.29193
                        10.915	6.76454
                        11.776	7.15836
                        12.971	7.59146
                        13.802	7.98541
                        15.0977	8.45801
                        16.745	8.9305
                        18.3177	9.28476
                        20.5986	9.83602
                        22.2241	10.151
                        24.1439	10.5053
                        26.7793	10.8594
                        29.908	11.2529
                        32.7175	11.5678
                        35.3002	11.8038
                        39.1534	12.1579
                        42.5361	12.4728
                        47.5071	12.7874
                        52.6956	12.9838
                        57.2491	13.2592
                        63.0605	13.6134
                        71.9074	13.8884
                        78.661	14.2427
                        90.9467	14.4781
                        101.574	14.8322
                        112.664	15.1075
                        132.989	15.3822
                        151.659	15.4205
                        ];
                    T_bar(:,1)=T_bar(:,1)/150-1;
                    data_len=length(data);
                    data{data_len+1}.x=T_bar(:,1);
                    data{data_len+1}.y=T_bar(:,2);
                %stress=[
                 %       ];
                  %  data_len=length(data);
                   % data{data_len+1}.x=stress(:,1);
                    %data{data_len+1}.y=stress(:,2);

            end
        case 550
                case 'u_prime_u_prime'
                case 'v_prime_v_prime'
                case 'w_prime_w_prime'
                case 'u_prime_v_prime'
                case 'u_prime_T_prime'
                case 'v_prime_T_prime'
                case 'w_prime_T_prime'
        otherwise 
            error('No data included');
    end


end